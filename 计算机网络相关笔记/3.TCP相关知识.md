## TCP相关知识

#### 1.TCP三次握手与四次挥手

- 序列号： 在建立连接时，由计算机生成的随机数为其初始值，通过SYN包传给接收端主机，每发送一次数据，就累加一次该数据字节数大小，用来解决网络包乱序问题
- 确认应答号：指下一次期望收到的数据的序列号，发送端收到这个确认应答以后可以认为在这个序号以前的数据都已经被正常接收，用来解决不丢包的问题。
- 控制位：
  - ACK：该位为1时，确认应答字段变为有效，TCP规定除了最初建立连接时SYN包之外该位必须设置为1
  - RST：该位为1时，表示TCP连接中出现异常必须强制断开连接
  - SYN：该位为1时，表示希望建立连接，并在其序列号的字段进行序列号初始值的设定
  - FIN：该位为1时，表似乎今后不会再有数据发送，希望断开连接，当通信结束希望断开连接时，通信双方的主机之间就可以相互交换FIN位为1的TCP段

> 为什么需要TCP，TCP工作在哪一层

TCP保证了可靠的传输

TCP在传输层

> 什么是TCP

TCP是面向连接的、可靠的、基于字节流的传输层通信协议

> 什么是TCP连接

用于保证可靠性和流量控制维护的某些状态信息，这些信息的组合，包括Socket、序列号和窗口大小称为连接

> 如何唯一确定一个TCP连接

通过TCP四元组：源地址、源端口号、目的地址、目的端口号

地址在IP头部中，端口在TCP头部中

> 有一个IP的服务器监听了一个端口，它的TCP最大连接数是多少

最大TCP连接数 = 客户端IP * 客户端的端口数

>UDP和TCP区别？应用场景是什么

TCP 准 UDP 快

TCP和UDP应用场景：

TCP：

- FTP文件传输
- HTTP/HTTPS

UDP：

- 包总量较少的通信，如DNS、SNMP等
- 视频、音频等多媒体通信
- 广播通信

> 为什么UDP头部没有首部长度字段，而TCP有首部长度字段

TCP有可变长选项字段，而UDP头部长度不会变化

> 为什么UDP头部有包长度字段，而TCP头部没有包长度字段

TCP数据长度 = IP长度 - IP头部长度 - TCP头部长度，通过计算得来

UDP为了网络设备硬件设计和处理方便，首部长度需要是4字节整数倍，所以设计了包长度字段

****

##### TCP连接建立

> TCP三次握手过程和状态变迁

- 一开始客户端和服务端都处于CLOSED状态，服务端主动监听某个接口，处于LISTEN状态

- 三次握手第一个报文：客户端随机初始化序列号，将序列号置于TCP头部的序号字段中，同时把SYN标志位置为1，表示SYN报文，接着把第一个SYN报文发送给服务端，表示向服务端发起连接，该报文不包含应用层数据，之后客户端处于SYN-SENT状态
- 三次握手第二个报文：服务端收到客户端的SYN报文后，服务端也随机初始化自己的序号，将此序号填入TCP头部字段中，其次把TCP头部的确认应答号字段填入 client_isn + 1，接着把SYN和ACK标志位置为1，最后把该报文发送给客户端，该报文也不包含应用层数据，之后服务端处于SYN-RCVD状态
- 客户端收到服务端报文后，还要向服务端回应最后一个应答报文，首先该应答报文TCP头部ACK标志位置为1，其次确认应答号字段填入server_isn + 1，最后把报文发送给服务端，这次报文可以携带客户到服务器的数据，之后客户端处于ESTABLISHED状态
- 服务器收到客户端的应答报文后，也进入ESTABLISHED状态