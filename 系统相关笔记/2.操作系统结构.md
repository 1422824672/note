## 操作系统结构

#### 1 Linux内核 VS Windows内核

##### 内核

应用连接硬件设备的桥梁，让应用只需要关心与内核交互，不用关心硬件的细节

基本能力：

- 进程调度的能力
- 内存管理的能力
- 硬件通信的能力
- 提供系统调用

内核具有很高的权限，而应用程序具有的权限很小，因此大多数操作系统，将内存分为了两个区域：

- 内核空间，这个内存空间只有内核程序可以访问
- 用户空间，这个内存空间专门给应用程序使用

应用程序若要进入内核空间，就需要通过系统的调用

****

##### Linux的设计

- MutiTask，多任务
- SMP，对称多处理
- ELF，可执行文件链接格式
- Monolithic Kernel，宏内核

****

##### MutiTask

并发或并行来执行多任务

****

##### SMP

对称多处理，代表着每个CPU地位是相等的

****

##### ELF

是Linux操作系统中可执行文件的存储格式

通过编译器编译成汇编代码，再通过汇编器变成目标代码，最后通过链接器把多个目标文件以及调用的各种函数库链接起来，形成一个可执行文件，叫做ELF文件

执行ELF文件的时候，通过装载器把ELF装载到内存中，CPU读取内存中的指令和数据来执行

****

##### Monolithic Kernel

意味着Linux的内核是一个完整的可执行程序，且拥有最高的权限

宏内核特征是系统内核的所有模块，比如进程调度、内存管理、文件系统等等都运行在内核态

Linux实现了动态加载内核模块的功能

与宏内核相反的是微内核，微内核架构的内核只保留最基本的能力，比如进程调度、虚拟机内存、中断等等，把一些应用放到了用户空间，比如驱动程序、文件系统等，这样服务与服务之间是隔离的，单个服务出故障，不会导致整个操作系统挂掉，提高操作系统的稳定性和可靠性

微内核的内核功能少，但可移植性高，由于驱动程序你在内核中，而且驱动程序一般会频繁调用底层能力，预示驱动和硬件设备交互需要频繁切换到内核态，会带来性能损耗

混合类型内核架构像微内核，实现跟宏内核类似，把真个内核做成一个完整程序，大部分服务都在内核中

****

##### Windows设计

当今Windows 7、10使用的是windows NT的内核 NT New Technology

Windows同样支持MutiTask和SMP，但Windows的内核设计是混合型内核

Windows的可执行文件与Linux不同

Windows上的可执行文件叫做PE，称为可移植执行文件，扩展名通常为 .exe .dll .sys

