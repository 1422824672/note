## 进程与线程

#### 1.进程、线程基础知识

##### 进程

运行中的程序，被称为进程

多个程序、交替执行，就是CPU管理多个进程的初步想法

CPU一秒钟可能运行多个进程，会产生并行的错觉，实际上是并发

****

##### 进程的状态

三种基本状态：运行状态、就绪状态、阻塞状态（因为输入输出等操作不能继续进行，即使给予CPU也不能操作）

基本状态：创建状态和结束状态

阻塞会进入到就绪状态，而非回到运行状态

描述进程没有占用实际的物理内存空间的情况，这个状态就是挂起状态

- 阻塞挂起状态
- 就绪挂起状态

以下情况也可能挂起：

- 通过sleep挂起
- 主动挂起程序执行

****

##### 进程的控制结构

- 进程控制块（PCB）数据结构来描述进程

> PCB包含的信息

进程描述信息：

- 进程标识符
- 用户标识符

进程控制和管理信息：

- 进程当前状态
- 进程优先级

资源分配清单

CPU相关信息

> 每个PCB是如何组织的

通常通过链表组织，组成各种队列，例如：

- 处于就绪状态的进程链在一起，称为就绪队列

除了链接的组织方式，还有索引方式，工作原理是将同一状态的进程组织在一个索引表中

****

##### 进程的控制

- 创建进程 允许一个进程创建另一个进程
- 终止进程 分为三种终止方式 正常结束、异常结束以及外界干预
- 阻塞进程
- 唤醒进程 与阻塞进程相对应

****

##### 进程的上下文切换

一个进程切换到另一个进程，称为进程的上下文切换

操作系统需要实现帮CPU设置好CPU寄存器和程序计数器

> 进程的上下文切换

****

#### 线程

> 为什么使用线程？

- 实体之间可以并发运行
- 实体之间共享相同的地址空间

线程之间可以并发运行并且共享相同的地址空间

数据流可以共享，控制流相对独立

> 线程的优缺点？

优点：

- 一个进程可以同时存在多个线程
- 各个线程之间可以并发执行
- 各个线程之间可以共享地址空间和文件等资源

缺点：

- 一个线程崩，所属进程其余线程全部崩

****

##### 线程与进程的比较

- 进程是资源分配单位，线程是CPU调度的单位
- 进程拥有一个完整的资源平台，而线程只独享必不可少的资源，如寄存器和栈
- 线程同样具有就绪、阻塞、执行三种基本状态，同样具有状态之间的转换关系
- 线程能减少并发执行的时间和空间开销

****

##### 线程的上下文切换

线程是调度的基本单位，而进程则是资源拥有的基本单位

- 当两个线程不是属于同一个进程，则切换的过程就跟进程上下文切换一样
- 当两个线程是同属于一个进程，所以切换时只需要切换线程的私有数据、寄存器等不共享的数据

****

##### 线程的实现

- 用户线程
- 内核线程
- 轻量级进程

线程控制块TCB存在于用户态的线程管理库来实现的，用户线程的整个线程管理和调度，操作系统是不直接参与的，而是由用户级线程库函数来完成线程的管理，包括线程的创建、终止、同步和调度等

